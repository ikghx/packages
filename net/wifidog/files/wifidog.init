#!/bin/sh /etc/rc.common
# Copyright (C) 2006 OpenWrt.org
START=65

USE_PROCD=1

extra_command "status" "Print the status of the service"

start_instance() {
	local cfg="$1"
	local enabled

	config_get_bool enabled "$cfg" 'enabled' 0
	[ $enabled -gt 0 ] || return 1

	procd_open_instance
	# -s: log to syslog
	# -f: run in foreground
	procd_set_param command /usr/bin/wifidog -s -f
	procd_set_param respawn # respawn automatically if something died
	procd_set_param file /etc/wifidog.conf
	procd_close_instance
}

start_service() {
	config_load 'wifidog'
	config_foreach start_instance 'base'
}

service_triggers() {
	procd_add_reload_trigger "wifidog"
}

status_service() {
	/usr/bin/wdctl status
}
